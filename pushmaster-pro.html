<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PushMaster Pro ‚Äî AI Push-Up Counter</title>

<!-- MediaPipe Pose -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>

<!-- Chart.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;900&family=Rajdhani:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
/* ============================================================
   CSS CUSTOM PROPERTIES & RESET
   ============================================================ */
:root {
  --bg-primary: #080810;
  --bg-secondary: #0d0d1a;
  --bg-card: rgba(15, 15, 30, 0.8);
  --bg-glass: rgba(255, 255, 255, 0.03);

  --accent-blue: #00d4ff;
  --accent-blue-dim: rgba(0, 212, 255, 0.15);
  --accent-blue-glow: rgba(0, 212, 255, 0.4);
  --accent-gold: #ffd700;
  --accent-gold-dim: rgba(255, 215, 0, 0.15);
  --accent-gold-glow: rgba(255, 215, 0, 0.4);
  --accent-green: #00ff88;
  --accent-red: #ff3366;
  --accent-purple: #7b2fff;

  --text-primary: #f0f0ff;
  --text-secondary: rgba(240, 240, 255, 0.6);
  --text-muted: rgba(240, 240, 255, 0.3);

  --border: rgba(0, 212, 255, 0.15);
  --border-glow: rgba(0, 212, 255, 0.4);

  --font-display: 'Orbitron', monospace;
  --font-body: 'Rajdhani', sans-serif;
  --font-mono: 'Space Mono', monospace;

  --radius-sm: 8px;
  --radius-md: 16px;
  --radius-lg: 24px;
  --radius-xl: 32px;

  --shadow-neon: 0 0 30px rgba(0, 212, 255, 0.3), 0 0 60px rgba(0, 212, 255, 0.1);
  --shadow-gold: 0 0 30px rgba(255, 215, 0, 0.3), 0 0 60px rgba(255, 215, 0, 0.1);
  --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.5), 0 2px 8px rgba(0, 0, 0, 0.3);
}

.neon-theme {
  --accent-blue: #00ff88;
  --accent-blue-dim: rgba(0, 255, 136, 0.15);
  --accent-blue-glow: rgba(0, 255, 136, 0.4);
  --border: rgba(0, 255, 136, 0.15);
  --border-glow: rgba(0, 255, 136, 0.4);
  --shadow-neon: 0 0 30px rgba(0, 255, 136, 0.3), 0 0 60px rgba(0, 255, 136, 0.1);
}

*, *::before, *::after {
  margin: 0; padding: 0; box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
}

body {
  font-family: var(--font-body);
  background: var(--bg-primary);
  color: var(--text-primary);
  overflow-x: hidden;
  min-height: 100vh;
  transition: all 0.3s ease;
}

/* ============================================================
   ANIMATED PARTICLE BACKGROUND
   ============================================================ */
#particles-canvas {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  z-index: 0;
  pointer-events: none;
}

/* ============================================================
   SCROLLBAR
   ============================================================ */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: var(--bg-primary); }
::-webkit-scrollbar-thumb { background: var(--accent-blue); border-radius: 2px; }

/* ============================================================
   LAYOUT
   ============================================================ */
.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 24px;
  position: relative;
  z-index: 1;
}

/* ============================================================
   HEADER / NAV
   ============================================================ */
header {
  position: fixed;
  top: 0; left: 0; right: 0;
  z-index: 100;
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  background: rgba(8, 8, 16, 0.85);
  border-bottom: 1px solid var(--border);
}

nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 24px;
  max-width: 1400px;
  margin: 0 auto;
}

.logo {
  display: flex;
  align-items: center;
  gap: 12px;
  text-decoration: none;
}

.logo-icon {
  width: 40px; height: 40px;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  box-shadow: var(--shadow-neon);
}

.logo-text {
  font-family: var(--font-display);
  font-size: 18px;
  font-weight: 700;
  color: var(--text-primary);
  letter-spacing: 2px;
}

.logo-text span {
  color: var(--accent-blue);
}

.nav-actions {
  display: flex;
  align-items: center;
  gap: 12px;
}

.icon-btn {
  width: 40px; height: 40px;
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: var(--text-secondary);
  transition: all 0.3s ease;
  font-size: 16px;
}

.icon-btn:hover {
  border-color: var(--accent-blue);
  color: var(--accent-blue);
  box-shadow: 0 0 15px var(--accent-blue-dim);
  transform: translateY(-1px);
}

.icon-btn.active {
  background: var(--accent-blue-dim);
  border-color: var(--accent-blue);
  color: var(--accent-blue);
}

/* ============================================================
   HERO SECTION
   ============================================================ */
#hero {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 120px 24px 80px;
  position: relative;
}

.hero-badge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: var(--accent-blue-dim);
  border: 1px solid var(--border-glow);
  border-radius: 100px;
  padding: 8px 20px;
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--accent-blue);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 32px;
  animation: fadeInDown 0.8s ease forwards;
  opacity: 0;
  animation-delay: 0.2s;
}

.hero-badge .dot {
  width: 6px; height: 6px;
  background: var(--accent-blue);
  border-radius: 50%;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.5; transform: scale(0.8); }
}

@keyframes fadeInDown {
  from { opacity: 0; transform: translateY(-20px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.hero-title {
  font-family: var(--font-display);
  font-size: clamp(40px, 8vw, 96px);
  font-weight: 900;
  line-height: 1.05;
  letter-spacing: -2px;
  margin-bottom: 24px;
  animation: fadeInUp 0.8s ease forwards;
  opacity: 0;
  animation-delay: 0.4s;
}

.hero-title .line1 { display: block; color: var(--text-primary); }
.hero-title .line2 {
  display: block;
  background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple), var(--accent-gold));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  filter: drop-shadow(0 0 20px var(--accent-blue-glow));
}

.hero-desc {
  font-size: clamp(16px, 2vw, 20px);
  color: var(--text-secondary);
  max-width: 600px;
  margin: 0 auto 48px;
  line-height: 1.7;
  font-weight: 300;
  animation: fadeInUp 0.8s ease forwards;
  opacity: 0;
  animation-delay: 0.6s;
}

.hero-cta {
  display: flex;
  gap: 16px;
  justify-content: center;
  flex-wrap: wrap;
  animation: fadeInUp 0.8s ease forwards;
  opacity: 0;
  animation-delay: 0.8s;
}

.btn-primary {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 12px;
  padding: 18px 40px;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
  border: none;
  border-radius: var(--radius-md);
  font-family: var(--font-display);
  font-size: 14px;
  font-weight: 700;
  letter-spacing: 2px;
  color: #000;
  cursor: pointer;
  overflow: hidden;
  transition: all 0.3s ease;
  text-decoration: none;
}

.btn-primary::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.2), transparent);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.btn-primary:hover {
  transform: translateY(-3px);
  box-shadow: 0 20px 60px rgba(0, 212, 255, 0.5);
}

.btn-primary:hover::before { opacity: 1; }

.btn-primary .btn-glow {
  position: absolute;
  inset: -2px;
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
  border-radius: inherit;
  opacity: 0;
  z-index: -1;
  filter: blur(12px);
  transition: opacity 0.3s ease;
}

.btn-primary:hover .btn-glow { opacity: 0.6; }

.btn-secondary {
  display: inline-flex;
  align-items: center;
  gap: 12px;
  padding: 18px 40px;
  background: transparent;
  border: 1px solid var(--border-glow);
  border-radius: var(--radius-md);
  font-family: var(--font-display);
  font-size: 14px;
  font-weight: 600;
  letter-spacing: 2px;
  color: var(--accent-blue);
  cursor: pointer;
  transition: all 0.3s ease;
  text-decoration: none;
}

.btn-secondary:hover {
  background: var(--accent-blue-dim);
  box-shadow: var(--shadow-neon);
  transform: translateY(-3px);
}

/* Hero stats */
.hero-stats {
  display: flex;
  justify-content: center;
  gap: 48px;
  margin-top: 80px;
  padding-top: 48px;
  border-top: 1px solid var(--border);
  animation: fadeIn 1s ease forwards;
  opacity: 0;
  animation-delay: 1s;
  flex-wrap: wrap;
}

.hero-stat {
  text-align: center;
}

.hero-stat-number {
  font-family: var(--font-display);
  font-size: 36px;
  font-weight: 900;
  color: var(--accent-blue);
  display: block;
  line-height: 1;
}

.hero-stat-label {
  font-size: 13px;
  color: var(--text-muted);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-top: 6px;
  display: block;
}

/* ============================================================
   WORKOUT SECTION
   ============================================================ */
#workout {
  padding: 60px 24px;
  display: none;
}

#workout.active { display: block; }

.workout-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 32px;
  flex-wrap: wrap;
  gap: 16px;
}

.workout-title {
  font-family: var(--font-display);
  font-size: 24px;
  font-weight: 700;
  letter-spacing: 2px;
  color: var(--text-primary);
}

.workout-controls {
  display: flex;
  gap: 12px;
  align-items: center;
  flex-wrap: wrap;
}

.workout-layout {
  display: grid;
  grid-template-columns: 1fr 380px;
  gap: 24px;
  align-items: start;
}

@media (max-width: 1100px) {
  .workout-layout {
    grid-template-columns: 1fr;
  }
}

/* Camera area */
.camera-container {
  position: relative;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  overflow: hidden;
  aspect-ratio: 16/9;
  backdrop-filter: blur(10px);
  box-shadow: var(--shadow-card), inset 0 1px 0 rgba(255,255,255,0.05);
}

.camera-container::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  background: linear-gradient(135deg, var(--accent-blue-dim) 0%, transparent 60%);
  z-index: 1;
  pointer-events: none;
}

#video-feed {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transform: scaleX(-1);
}

#pose-canvas {
  position: absolute;
  top: 0; left: 0;
  width: 100%; height: 100%;
  transform: scaleX(-1);
  z-index: 2;
}

.camera-overlay {
  position: absolute;
  inset: 0;
  z-index: 3;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  gap: 20px;
  background: rgba(8, 8, 16, 0.7);
  backdrop-filter: blur(8px);
}

.camera-overlay.hidden { display: none; }

.camera-icon {
  width: 80px; height: 80px;
  background: var(--accent-blue-dim);
  border: 2px solid var(--accent-blue);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 36px;
  color: var(--accent-blue);
  box-shadow: var(--shadow-neon);
  animation: pulse-ring 2s infinite;
}

@keyframes pulse-ring {
  0% { box-shadow: 0 0 0 0 var(--accent-blue-glow), var(--shadow-neon); }
  70% { box-shadow: 0 0 0 20px transparent, var(--shadow-neon); }
  100% { box-shadow: 0 0 0 0 transparent, var(--shadow-neon); }
}

.camera-overlay-text {
  font-family: var(--font-display);
  font-size: 16px;
  color: var(--text-secondary);
  letter-spacing: 2px;
}

/* Corner decorations */
.corner {
  position: absolute;
  width: 20px; height: 20px;
  border-color: var(--accent-blue);
  border-style: solid;
  z-index: 4;
  opacity: 0.7;
}
.corner-tl { top: 16px; left: 16px; border-width: 2px 0 0 2px; }
.corner-tr { top: 16px; right: 16px; border-width: 2px 2px 0 0; }
.corner-bl { bottom: 16px; left: 16px; border-width: 0 0 2px 2px; }
.corner-br { bottom: 16px; right: 16px; border-width: 0 2px 2px 0; }

/* Live indicator */
.live-badge {
  position: absolute;
  top: 16px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 5;
  display: flex;
  align-items: center;
  gap: 8px;
  background: rgba(0,0,0,0.6);
  border: 1px solid var(--accent-red);
  border-radius: 100px;
  padding: 6px 16px;
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--accent-red);
  letter-spacing: 2px;
  display: none;
}

.live-badge.active { display: flex; }

.live-dot {
  width: 6px; height: 6px;
  background: var(--accent-red);
  border-radius: 50%;
  animation: blink 1s infinite;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

/* Form feedback bar */
.form-feedback {
  position: absolute;
  bottom: 16px;
  left: 16px; right: 16px;
  z-index: 5;
  background: rgba(0,0,0,0.75);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 12px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  backdrop-filter: blur(8px);
  display: none;
}

.form-feedback.active { display: flex; }

.feedback-text {
  font-family: var(--font-display);
  font-size: 13px;
  letter-spacing: 1px;
  transition: all 0.3s ease;
}

.feedback-text.good { color: var(--accent-green); }
.feedback-text.warn { color: var(--accent-gold); }
.feedback-text.bad { color: var(--accent-red); }

.confidence-bar-wrap {
  display: flex;
  align-items: center;
  gap: 8px;
}

.confidence-label {
  font-size: 11px;
  color: var(--text-muted);
  font-family: var(--font-mono);
}

.confidence-bar {
  width: 80px; height: 4px;
  background: rgba(255,255,255,0.1);
  border-radius: 2px;
  overflow: hidden;
}

.confidence-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent-blue), var(--accent-green));
  border-radius: 2px;
  transition: width 0.3s ease;
  width: 0%;
}

/* ============================================================
   STATS SIDEBAR
   ============================================================ */
.stats-sidebar {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

/* Big counter card */
.counter-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 32px;
  text-align: center;
  backdrop-filter: blur(20px);
  box-shadow: var(--shadow-card);
  position: relative;
  overflow: hidden;
}

.counter-card::before {
  content: '';
  position: absolute;
  top: 0; left: 50%;
  transform: translateX(-50%);
  width: 200px; height: 1px;
  background: linear-gradient(90deg, transparent, var(--accent-blue), transparent);
}

.counter-label {
  font-family: var(--font-mono);
  font-size: 11px;
  letter-spacing: 3px;
  color: var(--text-muted);
  text-transform: uppercase;
  margin-bottom: 12px;
}

.counter-number {
  font-family: var(--font-display);
  font-size: 88px;
  font-weight: 900;
  line-height: 1;
  color: var(--accent-blue);
  text-shadow: 0 0 40px var(--accent-blue-glow);
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  display: block;
}

.counter-number.animate {
  animation: countPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes countPop {
  0% { transform: scale(1); }
  50% { transform: scale(1.15); }
  100% { transform: scale(1); }
}

.counter-sub {
  font-size: 13px;
  color: var(--text-secondary);
  margin-top: 8px;
}

/* Mini stat cards */
.mini-stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.mini-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  padding: 20px 16px;
  backdrop-filter: blur(20px);
  box-shadow: var(--shadow-card);
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
}

.mini-card:hover {
  border-color: var(--accent-blue);
  transform: translateY(-2px);
  box-shadow: var(--shadow-card), var(--shadow-neon);
}

.mini-card-icon {
  font-size: 20px;
  margin-bottom: 10px;
  display: block;
}

.mini-card-value {
  font-family: var(--font-display);
  font-size: 28px;
  font-weight: 700;
  color: var(--text-primary);
  display: block;
  line-height: 1;
}

.mini-card-label {
  font-size: 11px;
  color: var(--text-muted);
  letter-spacing: 1px;
  text-transform: uppercase;
  margin-top: 6px;
  display: block;
}

.mini-card.green { border-color: rgba(0, 255, 136, 0.2); }
.mini-card.green .mini-card-icon { color: var(--accent-green); }
.mini-card.green .mini-card-value { color: var(--accent-green); }

.mini-card.red { border-color: rgba(255, 51, 102, 0.2); }
.mini-card.red .mini-card-icon { color: var(--accent-red); }
.mini-card.red .mini-card-value { color: var(--accent-red); }

.mini-card.gold { border-color: rgba(255, 215, 0, 0.2); }
.mini-card.gold .mini-card-icon { color: var(--accent-gold); }
.mini-card.gold .mini-card-value { color: var(--accent-gold); }

.mini-card.purple { border-color: rgba(123, 47, 255, 0.2); }
.mini-card.purple .mini-card-icon { color: var(--accent-purple); }
.mini-card.purple .mini-card-value { color: var(--accent-purple); }

/* Timer card */
.timer-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  padding: 20px 24px;
  backdrop-filter: blur(20px);
  box-shadow: var(--shadow-card);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.timer-display {
  font-family: var(--font-mono);
  font-size: 32px;
  font-weight: 700;
  color: var(--text-primary);
  letter-spacing: 4px;
}

.timer-meta {
  text-align: right;
}

.timer-label {
  font-size: 11px;
  color: var(--text-muted);
  letter-spacing: 2px;
  text-transform: uppercase;
  display: block;
}

.calories-display {
  font-family: var(--font-display);
  font-size: 24px;
  font-weight: 700;
  color: var(--accent-gold);
  display: block;
  margin-top: 4px;
}

/* Progress ring */
.goal-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  padding: 20px 24px;
  backdrop-filter: blur(20px);
  box-shadow: var(--shadow-card);
  display: flex;
  align-items: center;
  gap: 20px;
}

.goal-ring-wrap {
  position: relative;
  width: 72px; height: 72px;
  flex-shrink: 0;
}

.goal-ring {
  transform: rotate(-90deg);
  width: 100%; height: 100%;
}

.goal-ring-track {
  fill: none;
  stroke: rgba(255,255,255,0.05);
  stroke-width: 6;
}

.goal-ring-fill {
  fill: none;
  stroke: var(--accent-blue);
  stroke-width: 6;
  stroke-linecap: round;
  stroke-dasharray: 188.5;
  stroke-dashoffset: 188.5;
  transition: stroke-dashoffset 0.5s ease;
  filter: drop-shadow(0 0 6px var(--accent-blue));
}

.goal-ring-text {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  font-family: var(--font-display);
  font-size: 14px;
  font-weight: 700;
  color: var(--accent-blue);
}

.goal-info { flex: 1; }
.goal-title { font-size: 11px; color: var(--text-muted); letter-spacing: 2px; text-transform: uppercase; }
.goal-desc { font-family: var(--font-display); font-size: 18px; font-weight: 600; color: var(--text-primary); margin-top: 4px; }

/* ============================================================
   DASHBOARD / HISTORY SECTION
   ============================================================ */
#dashboard {
  padding: 80px 24px;
  position: relative;
  z-index: 1;
}

.section-header {
  margin-bottom: 48px;
  text-align: center;
}

.section-eyebrow {
  font-family: var(--font-mono);
  font-size: 12px;
  letter-spacing: 4px;
  color: var(--accent-blue);
  text-transform: uppercase;
  margin-bottom: 16px;
  display: block;
}

.section-title {
  font-family: var(--font-display);
  font-size: clamp(28px, 4vw, 48px);
  font-weight: 700;
  letter-spacing: -1px;
}

/* Chart card */
.chart-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 32px;
  backdrop-filter: blur(20px);
  box-shadow: var(--shadow-card);
  margin-bottom: 24px;
}

.chart-card-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 24px;
}

.chart-title {
  font-family: var(--font-display);
  font-size: 16px;
  font-weight: 600;
  letter-spacing: 1px;
}

/* History table */
.history-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  overflow: hidden;
  backdrop-filter: blur(20px);
  box-shadow: var(--shadow-card);
}

.history-header {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.history-header h3 {
  font-family: var(--font-display);
  font-size: 16px;
  font-weight: 600;
  letter-spacing: 1px;
}

.history-table {
  width: 100%;
  border-collapse: collapse;
}

.history-table th {
  padding: 12px 24px;
  text-align: left;
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-muted);
  letter-spacing: 2px;
  text-transform: uppercase;
  border-bottom: 1px solid var(--border);
}

.history-table td {
  padding: 16px 24px;
  font-size: 14px;
  color: var(--text-secondary);
  border-bottom: 1px solid rgba(255,255,255,0.03);
}

.history-table tr:hover td {
  background: var(--bg-glass);
  color: var(--text-primary);
}

.history-table tr:last-child td { border-bottom: none; }

.badge {
  display: inline-flex;
  align-items: center;
  padding: 3px 10px;
  border-radius: 100px;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 1px;
}

.badge-green { background: rgba(0, 255, 136, 0.15); color: var(--accent-green); }
.badge-gold { background: rgba(255, 215, 0, 0.15); color: var(--accent-gold); }
.badge-blue { background: var(--accent-blue-dim); color: var(--accent-blue); }

/* ============================================================
   SETTINGS PANEL
   ============================================================ */
.settings-panel {
  position: fixed;
  top: 0; right: 0;
  height: 100vh;
  width: 360px;
  background: rgba(13, 13, 26, 0.97);
  border-left: 1px solid var(--border);
  z-index: 200;
  transform: translateX(100%);
  transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  backdrop-filter: blur(30px);
  overflow-y: auto;
}

.settings-panel.open { transform: translateX(0); }

.settings-header {
  padding: 24px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.settings-header h2 {
  font-family: var(--font-display);
  font-size: 16px;
  letter-spacing: 2px;
}

.settings-body { padding: 24px; }

.setting-group { margin-bottom: 32px; }

.setting-group-label {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-muted);
  letter-spacing: 3px;
  text-transform: uppercase;
  margin-bottom: 16px;
  display: block;
}

.setting-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 0;
  border-bottom: 1px solid rgba(255,255,255,0.04);
}

.setting-item:last-child { border-bottom: none; }

.setting-info { flex: 1; }

.setting-name {
  font-size: 14px;
  color: var(--text-primary);
  display: block;
}

.setting-desc {
  font-size: 12px;
  color: var(--text-muted);
  margin-top: 2px;
  display: block;
}

/* Toggle switch */
.toggle {
  position: relative;
  width: 44px; height: 24px;
  cursor: pointer;
}

.toggle input {
  opacity: 0; width: 0; height: 0;
}

.toggle-slider {
  position: absolute;
  inset: 0;
  background: rgba(255,255,255,0.1);
  border-radius: 24px;
  transition: all 0.3s ease;
  border: 1px solid rgba(255,255,255,0.1);
}

.toggle-slider::before {
  content: '';
  position: absolute;
  height: 18px; width: 18px;
  left: 2px; bottom: 2px;
  background: var(--text-secondary);
  border-radius: 50%;
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.toggle input:checked + .toggle-slider {
  background: var(--accent-blue-dim);
  border-color: var(--accent-blue);
  box-shadow: 0 0 10px var(--accent-blue-dim);
}

.toggle input:checked + .toggle-slider::before {
  transform: translateX(20px);
  background: var(--accent-blue);
}

/* Goal input */
.goal-input-wrap {
  display: flex;
  gap: 8px;
  align-items: center;
}

.goal-input {
  flex: 1;
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 10px 16px;
  font-family: var(--font-mono);
  font-size: 16px;
  color: var(--text-primary);
  outline: none;
  transition: all 0.3s ease;
  width: 80px;
}

.goal-input:focus {
  border-color: var(--accent-blue);
  box-shadow: 0 0 10px var(--accent-blue-dim);
}

/* ============================================================
   WORKOUT SUMMARY MODAL
   ============================================================ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  z-index: 300;
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(8px);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
  padding: 24px;
}

.modal-overlay.active {
  opacity: 1;
  pointer-events: all;
}

.modal {
  background: linear-gradient(135deg, rgba(13,13,26,0.98), rgba(20,20,40,0.98));
  border: 1px solid var(--border-glow);
  border-radius: var(--radius-xl);
  padding: 48px;
  max-width: 560px;
  width: 100%;
  box-shadow: var(--shadow-neon), 0 40px 80px rgba(0,0,0,0.7);
  transform: scale(0.9);
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  position: relative;
  overflow: hidden;
}

.modal-overlay.active .modal { transform: scale(1); }

.modal::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--accent-blue), transparent);
}

.modal-trophy {
  text-align: center;
  font-size: 64px;
  margin-bottom: 24px;
  display: block;
  animation: bounceIn 0.5s ease 0.2s both;
}

@keyframes bounceIn {
  from { opacity: 0; transform: scale(0.3); }
  to { opacity: 1; transform: scale(1); }
}

.modal-title {
  font-family: var(--font-display);
  font-size: 28px;
  font-weight: 900;
  text-align: center;
  letter-spacing: 2px;
  margin-bottom: 8px;
  color: var(--accent-blue);
}

.modal-subtitle {
  text-align: center;
  color: var(--text-muted);
  font-size: 14px;
  margin-bottom: 36px;
}

.modal-stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 32px;
}

.modal-stat {
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  padding: 20px;
  text-align: center;
}

.modal-stat-value {
  font-family: var(--font-display);
  font-size: 32px;
  font-weight: 700;
  color: var(--text-primary);
  display: block;
}

.modal-stat-label {
  font-size: 11px;
  color: var(--text-muted);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-top: 6px;
  display: block;
}

.modal-actions {
  display: flex;
  gap: 12px;
  justify-content: center;
}

.modal-close {
  position: absolute;
  top: 20px; right: 20px;
  width: 36px; height: 36px;
  background: var(--bg-glass);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: var(--text-secondary);
  font-size: 18px;
  transition: all 0.2s ease;
}

.modal-close:hover {
  border-color: var(--accent-red);
  color: var(--accent-red);
}

/* ============================================================
   TOAST NOTIFICATIONS
   ============================================================ */
.toast-container {
  position: fixed;
  bottom: 24px;
  right: 24px;
  z-index: 400;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.toast {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  padding: 16px 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  backdrop-filter: blur(20px);
  box-shadow: var(--shadow-card);
  font-size: 14px;
  animation: toastIn 0.3s ease;
  min-width: 260px;
  max-width: 360px;
}

@keyframes toastIn {
  from { opacity: 0; transform: translateX(30px); }
  to { opacity: 1; transform: translateX(0); }
}

.toast-icon { font-size: 20px; }
.toast-text { flex: 1; color: var(--text-primary); }

/* ============================================================
   FOOTER
   ============================================================ */
footer {
  position: relative;
  z-index: 1;
  padding: 48px 24px;
  border-top: 1px solid var(--border);
  text-align: center;
}

.footer-social {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-bottom: 24px;
}

.social-link {
  width: 48px; height: 48px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--text-secondary);
  text-decoration: none;
  font-size: 20px;
  transition: all 0.3s ease;
}

.social-link:hover {
  border-color: var(--accent-blue);
  color: var(--accent-blue);
  box-shadow: var(--shadow-neon);
  transform: translateY(-4px);
}

.social-link:nth-child(2):hover {
  border-color: var(--text-primary);
  color: var(--text-primary);
  box-shadow: 0 0 20px rgba(255,255,255,0.2);
}

.social-link:nth-child(3):hover {
  border-color: #ff0050;
  color: #ff0050;
  box-shadow: 0 0 20px rgba(255, 0, 80, 0.3);
}

.footer-copy {
  font-size: 13px;
  color: var(--text-muted);
  letter-spacing: 1px;
}

.footer-copy span {
  color: var(--accent-blue);
}

.footer-disclaimer {
  margin-top: 16px;
  font-size: 11px;
  color: var(--text-muted);
  opacity: 0.6;
  max-width: 500px;
  margin-left: auto;
  margin-right: auto;
  line-height: 1.6;
}

/* ============================================================
   UTILITIES
   ============================================================ */
.hidden { display: none !important; }

.divider {
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--border-glow), transparent);
  margin: 0;
}

/* Phase indicator in camera */
.phase-indicator {
  position: absolute;
  top: 60px;
  right: 16px;
  z-index: 5;
  display: flex;
  flex-direction: column;
  gap: 6px;
  display: none;
}

.phase-indicator.active { display: flex; }

.phase-dot {
  width: 10px; height: 10px;
  border-radius: 50%;
  background: rgba(255,255,255,0.1);
  border: 1px solid rgba(255,255,255,0.2);
  transition: all 0.3s ease;
}

.phase-dot.active {
  background: var(--accent-blue);
  box-shadow: 0 0 8px var(--accent-blue);
  border-color: var(--accent-blue);
}

/* Streak flame */
#streakVal {
  position: relative;
}

/* Rep flash effect on camera */
.rep-flash {
  position: absolute;
  inset: 0;
  z-index: 6;
  border: 3px solid var(--accent-green);
  border-radius: var(--radius-lg);
  opacity: 0;
  pointer-events: none;
  box-shadow: inset 0 0 40px rgba(0, 255, 136, 0.3);
  transition: opacity 0.1s ease;
}

.rep-flash.flash {
  opacity: 1;
  animation: flashOut 0.6s ease forwards;
}

@keyframes flashOut {
  0% { opacity: 1; }
  100% { opacity: 0; }
}

/* Music player mini */
.music-bar {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-md);
  padding: 14px 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  backdrop-filter: blur(20px);
}

.music-eq {
  display: flex;
  gap: 3px;
  align-items: flex-end;
  height: 20px;
}

.music-eq span {
  display: block;
  width: 3px;
  background: var(--accent-blue);
  border-radius: 2px;
  animation: eq 1s ease-in-out infinite alternate;
}

.music-eq span:nth-child(1) { height: 8px; animation-delay: 0s; }
.music-eq span:nth-child(2) { height: 16px; animation-delay: 0.2s; }
.music-eq span:nth-child(3) { height: 12px; animation-delay: 0.1s; }
.music-eq span:nth-child(4) { height: 18px; animation-delay: 0.3s; }
.music-eq span:nth-child(5) { height: 10px; animation-delay: 0.15s; }

@keyframes eq {
  from { transform: scaleY(0.3); }
  to { transform: scaleY(1); }
}

.music-eq.paused span { animation-play-state: paused; }

.music-info { flex: 1; }
.music-title { font-size: 13px; color: var(--text-primary); display: block; }
.music-artist { font-size: 11px; color: var(--text-muted); display: block; margin-top: 2px; }

/* Responsive */
@media (max-width: 768px) {
  nav { padding: 12px 16px; }
  .logo-text { font-size: 14px; }
  .hero-cta { flex-direction: column; align-items: center; }
  .hero-stats { gap: 24px; }
  .modal { padding: 32px 24px; }
  .modal-stats { grid-template-columns: 1fr 1fr; }
  .settings-panel { width: 100%; }
  .mini-stats-grid { grid-template-columns: 1fr 1fr; }
}

@media (max-width: 480px) {
  .mini-stats-grid { grid-template-columns: 1fr 1fr; }
  .modal-stats { grid-template-columns: 1fr; }
  .counter-number { font-size: 64px; }
}

/* Fullscreen */
:fullscreen #workout { padding-top: 20px; }

/* Workout section padding */
#workout { padding-top: 100px; }
#hero { padding-top: 120px; }
</style>
</head>

<body>
<!-- Particle background -->
<canvas id="particles-canvas"></canvas>

<!-- ============================================================
     HEADER
     ============================================================ -->
<header>
  <nav>
    <a class="logo" href="#">
      <div class="logo-icon">üí™</div>
      <span class="logo-text">PUSH<span>MASTER</span> PRO</span>
    </a>
    <div class="nav-actions">
      <button class="icon-btn" id="themeToggleBtn" title="Toggle Theme">
        <i class="fas fa-bolt"></i>
      </button>
      <button class="icon-btn" id="soundToggleBtn" title="Toggle Sound">
        <i class="fas fa-volume-high"></i>
      </button>
      <button class="icon-btn" id="fullscreenBtn" title="Fullscreen">
        <i class="fas fa-expand"></i>
      </button>
      <button class="icon-btn" id="settingsBtn" title="Settings">
        <i class="fas fa-sliders"></i>
      </button>
    </div>
  </nav>
</header>

<!-- ============================================================
     HERO SECTION
     ============================================================ -->
<section id="hero">
  <div class="container" style="width:100%">
    <div class="hero-badge">
      <span class="dot"></span>
      AI-Powered Pose Detection
    </div>
    <h1 class="hero-title">
      <span class="line1">MASTER YOUR</span>
      <span class="line2">PUSH-UPS</span>
    </h1>
    <p class="hero-desc">
      Real-time AI form analysis powered by computer vision. Count reps, track perfection, and elevate every workout.
    </p>
    <div class="hero-cta">
      <button class="btn-primary" id="startWorkoutBtn">
        <div class="btn-glow"></div>
        <i class="fas fa-play"></i>
        START WORKOUT
      </button>
      <button class="btn-secondary" id="viewHistoryBtn">
        <i class="fas fa-chart-line"></i>
        VIEW HISTORY
      </button>
    </div>
    <div class="hero-stats">
      <div class="hero-stat">
        <span class="hero-stat-number" id="totalLifetimePushups">0</span>
        <span class="hero-stat-label">Lifetime Push-Ups</span>
      </div>
      <div class="hero-stat">
        <span class="hero-stat-number" id="totalSessions">0</span>
        <span class="hero-stat-label">Sessions</span>
      </div>
      <div class="hero-stat">
        <span class="hero-stat-number" id="bestSetStat">0</span>
        <span class="hero-stat-label">Best Set</span>
      </div>
      <div class="hero-stat">
        <span class="hero-stat-number" id="currentStreakStat">0</span>
        <span class="hero-stat-label">Day Streak</span>
      </div>
    </div>
  </div>
</section>

<!-- ============================================================
     WORKOUT SECTION
     ============================================================ -->
<section id="workout">
  <div class="container">
    <div class="workout-header">
      <div class="workout-title">
        <i class="fas fa-dumbbell" style="color:var(--accent-blue);margin-right:10px"></i>
        LIVE WORKOUT
      </div>
      <div class="workout-controls">
        <button class="btn-secondary" id="pauseBtn" style="padding:12px 24px;font-size:12px">
          <i class="fas fa-pause"></i> PAUSE
        </button>
        <button class="btn-primary" id="stopBtn" style="padding:12px 24px;font-size:12px;background:linear-gradient(135deg,var(--accent-red),#ff6b35);color:#fff">
          <div class="btn-glow"></div>
          <i class="fas fa-stop"></i> END
        </button>
      </div>
    </div>

    <div class="workout-layout">
      <!-- Camera -->
      <div>
        <div class="camera-container" id="cameraContainer">
          <video id="video-feed" playsinline muted></video>
          <canvas id="pose-canvas"></canvas>

          <!-- Corner decorations -->
          <div class="corner corner-tl"></div>
          <div class="corner corner-tr"></div>
          <div class="corner corner-bl"></div>
          <div class="corner corner-br"></div>

          <!-- Rep flash -->
          <div class="rep-flash" id="repFlash"></div>

          <!-- Live badge -->
          <div class="live-badge" id="liveBadge">
            <span class="live-dot"></span> LIVE
          </div>

          <!-- Camera overlay (shown before detection starts) -->
          <div class="camera-overlay" id="cameraOverlay">
            <div class="camera-icon">
              <i class="fas fa-camera"></i>
            </div>
            <p class="camera-overlay-text">INITIALIZING CAMERA...</p>
          </div>

          <!-- Phase dots -->
          <div class="phase-indicator" id="phaseIndicator">
            <div class="phase-dot" id="phaseUp" title="Up position"></div>
            <div class="phase-dot" id="phaseDown" title="Down position"></div>
          </div>

          <!-- Form feedback -->
          <div class="form-feedback" id="formFeedback">
            <span class="feedback-text good" id="feedbackText">üéØ Get into push-up position</span>
            <div class="confidence-bar-wrap">
              <span class="confidence-label">CONF</span>
              <div class="confidence-bar">
                <div class="confidence-fill" id="confidenceFill"></div>
              </div>
              <span id="confidenceVal" class="confidence-label">0%</span>
            </div>
          </div>
        </div>

        <!-- Music bar (below camera) -->
        <div class="music-bar" id="musicBar" style="margin-top:16px; display:none">
          <div class="music-eq" id="musicEq">
            <span></span><span></span><span></span><span></span><span></span>
          </div>
          <div class="music-info">
            <span class="music-title" id="musicTitle">Workout Beats Vol. 1</span>
            <span class="music-artist">PushMaster Pro</span>
          </div>
          <button class="icon-btn" id="musicPlayBtn" style="flex-shrink:0">
            <i class="fas fa-play" id="musicPlayIcon"></i>
          </button>
        </div>
      </div>

      <!-- Sidebar stats -->
      <div class="stats-sidebar">
        <!-- Main counter -->
        <div class="counter-card">
          <span class="counter-label">TOTAL PUSH-UPS</span>
          <span class="counter-number" id="repCount">0</span>
          <span class="counter-sub">üî• Keep going!</span>
        </div>

        <!-- Mini stats grid -->
        <div class="mini-stats-grid">
          <div class="mini-card green">
            <span class="mini-card-icon">‚úÖ</span>
            <span class="mini-card-value" id="perfectCount">0</span>
            <span class="mini-card-label">Perfect</span>
          </div>
          <div class="mini-card red">
            <span class="mini-card-icon">‚ùå</span>
            <span class="mini-card-value" id="wrongCount">0</span>
            <span class="mini-card-label">Wrong Form</span>
          </div>
          <div class="mini-card gold">
            <span class="mini-card-icon">üéØ</span>
            <span class="mini-card-value" id="accuracyVal">100%</span>
            <span class="mini-card-label">Accuracy</span>
          </div>
          <div class="mini-card purple">
            <span class="mini-card-icon">üí™</span>
            <span class="mini-card-value" id="streakVal">0</span>
            <span class="mini-card-label">Streak</span>
          </div>
        </div>

        <!-- Timer + calories -->
        <div class="timer-card">
          <div>
            <span class="timer-label">DURATION</span>
            <span class="timer-display" id="timerDisplay">00:00</span>
          </div>
          <div class="timer-meta">
            <span class="timer-label">CALORIES</span>
            <span class="calories-display" id="caloriesVal">0</span>
          </div>
        </div>

        <!-- Daily goal -->
        <div class="goal-card">
          <div class="goal-ring-wrap">
            <svg class="goal-ring" viewBox="0 0 72 72">
              <circle class="goal-ring-track" cx="36" cy="36" r="30"/>
              <circle class="goal-ring-fill" id="goalRingFill" cx="36" cy="36" r="30"/>
            </svg>
            <span class="goal-ring-text" id="goalPct">0%</span>
          </div>
          <div class="goal-info">
            <span class="goal-title">DAILY GOAL</span>
            <span class="goal-desc" id="goalDesc">0 / <span id="goalTarget">50</span> reps</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ============================================================
     DASHBOARD / HISTORY
     ============================================================ -->
<section id="dashboard">
  <div class="container">
    <div class="section-header">
      <span class="section-eyebrow">Analytics</span>
      <h2 class="section-title">Workout Dashboard</h2>
    </div>

    <div class="chart-card">
      <div class="chart-card-header">
        <span class="chart-title">Weekly Progress</span>
        <span style="font-size:12px;color:var(--text-muted);font-family:var(--font-mono)">LAST 7 DAYS</span>
      </div>
      <canvas id="weeklyChart" height="100"></canvas>
    </div>

    <div class="history-card">
      <div class="history-header">
        <h3>Workout History</h3>
        <button class="btn-secondary" id="exportBtn" style="padding:8px 16px;font-size:12px">
          <i class="fas fa-download"></i> Export
        </button>
      </div>
      <div id="historyTableWrap">
        <table class="history-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Reps</th>
              <th>Perfect</th>
              <th>Accuracy</th>
              <th>Duration</th>
              <th>Calories</th>
            </tr>
          </thead>
          <tbody id="historyBody">
            <tr>
              <td colspan="6" style="text-align:center;color:var(--text-muted);padding:40px">
                No workouts yet. Start your first session!
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<div class="divider"></div>

<!-- ============================================================
     FOOTER
     ============================================================ -->
<footer>
  <div class="footer-social">
    <a href="https://github.com/AmmarBinYasir-1" target="_blank" rel="noopener" class="social-link" title="GitHub">
      <i class="fab fa-github"></i>
    </a>
    <a href="https://x.com/AmmarBinYasir_1" target="_blank" rel="noopener" class="social-link" title="X / Twitter">
      <i class="fab fa-x-twitter"></i>
    </a>
    <a href="https://www.tiktok.com/@ammarbinyasir_1" target="_blank" rel="noopener" class="social-link" title="TikTok">
      <i class="fab fa-tiktok"></i>
    </a>
  </div>
  <p class="footer-copy">¬© 2026 <span>PushMaster Pro</span> ‚Äî Train Smart. Train Perfect.</p>
  <p class="footer-disclaimer">
    AI systems can make mistakes. Always double-check workout tracking accuracy.
  </p>
</footer>

<!-- ============================================================
     SETTINGS PANEL
     ============================================================ -->
<div class="settings-panel" id="settingsPanel">
  <div class="settings-header">
    <h2>SETTINGS</h2>
    <button class="icon-btn" id="closeSettingsBtn">
      <i class="fas fa-xmark"></i>
    </button>
  </div>
  <div class="settings-body">
    <div class="setting-group">
      <span class="setting-group-label">Appearance</span>
      <div class="setting-item">
        <div class="setting-info">
          <span class="setting-name">Neon Green Theme</span>
          <span class="setting-desc">Switch accent from blue to green</span>
        </div>
        <label class="toggle">
          <input type="checkbox" id="neonThemeToggle">
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>

    <div class="setting-group">
      <span class="setting-group-label">Audio</span>
      <div class="setting-item">
        <div class="setting-info">
          <span class="setting-name">Sound Effects</span>
          <span class="setting-desc">Rep count beeps & alerts</span>
        </div>
        <label class="toggle">
          <input type="checkbox" id="soundEffectToggle" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="setting-item">
        <div class="setting-info">
          <span class="setting-name">Workout Music</span>
          <span class="setting-desc">Background beats during workout</span>
        </div>
        <label class="toggle">
          <input type="checkbox" id="musicToggle">
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>

    <div class="setting-group">
      <span class="setting-group-label">Goals</span>
      <div class="setting-item">
        <div class="setting-info">
          <span class="setting-name">Daily Goal</span>
          <span class="setting-desc">Target push-ups per day</span>
        </div>
        <div class="goal-input-wrap">
          <input type="number" class="goal-input" id="dailyGoalInput" value="50" min="1" max="1000">
        </div>
      </div>
    </div>

    <div class="setting-group">
      <span class="setting-group-label">Data</span>
      <div class="setting-item">
        <div class="setting-info">
          <span class="setting-name">Clear History</span>
          <span class="setting-desc">Reset all workout data</span>
        </div>
        <button class="icon-btn" id="clearHistoryBtn" style="color:var(--accent-red);border-color:rgba(255,51,102,0.3)">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>

    <div style="margin-top:32px">
      <button class="btn-secondary" onclick="document.getElementById('startWorkoutBtn').click();document.getElementById('settingsPanel').classList.remove('open')" style="width:100%;justify-content:center">
        <i class="fas fa-play"></i> START WORKOUT
      </button>
    </div>
  </div>
</div>

<!-- ============================================================
     WORKOUT SUMMARY MODAL
     ============================================================ -->
<div class="modal-overlay" id="summaryModal">
  <div class="modal">
    <button class="modal-close" id="closeModalBtn">
      <i class="fas fa-xmark"></i>
    </button>
    <span class="modal-trophy">üèÜ</span>
    <h2 class="modal-title">WORKOUT COMPLETE</h2>
    <p class="modal-subtitle" id="modalSubtitle">Great session, champion!</p>
    <div class="modal-stats">
      <div class="modal-stat">
        <span class="modal-stat-value" id="modalReps" style="color:var(--accent-blue)">0</span>
        <span class="modal-stat-label">Total Reps</span>
      </div>
      <div class="modal-stat">
        <span class="modal-stat-value" id="modalPerfect" style="color:var(--accent-green)">0</span>
        <span class="modal-stat-label">Perfect</span>
      </div>
      <div class="modal-stat">
        <span class="modal-stat-value" id="modalAccuracy" style="color:var(--accent-gold)">0%</span>
        <span class="modal-stat-label">Accuracy</span>
      </div>
      <div class="modal-stat">
        <span class="modal-stat-value" id="modalCalories" style="color:var(--accent-purple)">0</span>
        <span class="modal-stat-label">Calories</span>
      </div>
      <div class="modal-stat">
        <span class="modal-stat-value" id="modalDuration" style="color:var(--text-primary)">0:00</span>
        <span class="modal-stat-label">Duration</span>
      </div>
      <div class="modal-stat">
        <span class="modal-stat-value" id="modalStreak" style="color:var(--accent-red)">0</span>
        <span class="modal-stat-label">Best Streak</span>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-secondary" id="newWorkoutBtn">
        <i class="fas fa-redo"></i> NEW WORKOUT
      </button>
      <button class="btn-primary" id="exportSummaryBtn">
        <div class="btn-glow"></div>
        <i class="fas fa-download"></i> EXPORT
      </button>
    </div>
  </div>
</div>

<!-- Toast container -->
<div class="toast-container" id="toastContainer"></div>

<!-- ============================================================
     JAVASCRIPT
     ============================================================ -->
<script>
/* ============================================================
   PARTICLE BACKGROUND
   ============================================================ */
(function() {
  const canvas = document.getElementById('particles-canvas');
  const ctx = canvas.getContext('2d');
  let W, H, particles;

  function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
  }

  function initParticles() {
    particles = [];
    const count = Math.min(120, Math.floor(W * H / 12000));
    for (let i = 0; i < count; i++) {
      particles.push({
        x: Math.random() * W,
        y: Math.random() * H,
        vx: (Math.random() - 0.5) * 0.3,
        vy: (Math.random() - 0.5) * 0.3,
        r: Math.random() * 1.5 + 0.5,
        alpha: Math.random() * 0.5 + 0.1
      });
    }
  }

  function getAccentColor() {
    return getComputedStyle(document.documentElement)
      .getPropertyValue('--accent-blue').trim() || '#00d4ff';
  }

  function draw() {
    ctx.clearRect(0, 0, W, H);
    const color = getAccentColor();

    particles.forEach(p => {
      p.x += p.vx;
      p.y += p.vy;
      if (p.x < 0) p.x = W;
      if (p.x > W) p.x = 0;
      if (p.y < 0) p.y = H;
      if (p.y > H) p.y = 0;

      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fillStyle = color.replace('#', 'rgba(') + ',' + p.alpha + ')';
      // simple color with alpha
      ctx.globalAlpha = p.alpha;
      ctx.fillStyle = color;
      ctx.fill();
      ctx.globalAlpha = 1;
    });

    // Draw connections
    for (let i = 0; i < particles.length; i++) {
      for (let j = i + 1; j < particles.length; j++) {
        const dx = particles[i].x - particles[j].x;
        const dy = particles[i].y - particles[j].y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < 120) {
          ctx.beginPath();
          ctx.moveTo(particles[i].x, particles[i].y);
          ctx.lineTo(particles[j].x, particles[j].y);
          ctx.strokeStyle = color;
          ctx.globalAlpha = (1 - dist / 120) * 0.08;
          ctx.stroke();
          ctx.globalAlpha = 1;
        }
      }
    }

    requestAnimationFrame(draw);
  }

  window.addEventListener('resize', () => { resize(); initParticles(); });
  resize();
  initParticles();
  draw();
})();

/* ============================================================
   APP STATE
   ============================================================ */
const STATE = {
  isWorkoutActive: false,
  isPaused: false,
  repCount: 0,
  perfectCount: 0,
  wrongCount: 0,
  currentStreak: 0,
  maxStreak: 0,
  timerSeconds: 0,
  timerInterval: null,
  dailyGoal: 50,
  soundEnabled: true,
  musicEnabled: false,
  posePrev: null,
  pushupPhase: 'up', // 'up' | 'down'
  lastAngle: null,
  downReached: false,
  backIssue: false,
  fastMovement: false,
  lastRepTime: 0,
  audioCtx: null,
  sessionHistory: [],
  lifetimeData: JSON.parse(localStorage.getItem('pmPro_lifetime') || '{"pushups":0,"sessions":0,"best":0,"streak":0,"lastDate":""}'),
  weeklyData: JSON.parse(localStorage.getItem('pmPro_weekly') || '[]'),
  historyLog: JSON.parse(localStorage.getItem('pmPro_history') || '[]'),
};

/* ============================================================
   AUDIO ENGINE
   ============================================================ */
function getAudioCtx() {
  if (!STATE.audioCtx) {
    STATE.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
  return STATE.audioCtx;
}

function playBeep(freq, dur, type = 'sine', vol = 0.3) {
  if (!STATE.soundEnabled) return;
  try {
    const ctx = getAudioCtx();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.type = type;
    osc.frequency.setValueAtTime(freq, ctx.currentTime);
    gain.gain.setValueAtTime(vol, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + dur);
    osc.start(ctx.currentTime);
    osc.stop(ctx.currentTime + dur);
  } catch(e) {}
}

function playRepSound(perfect) {
  if (perfect) {
    playBeep(880, 0.1, 'sine', 0.4);
    setTimeout(() => playBeep(1100, 0.15, 'sine', 0.3), 120);
  } else {
    playBeep(220, 0.3, 'sawtooth', 0.2);
  }
}

function playMilestoneSound() {
  [523, 659, 784, 1047].forEach((f, i) => {
    setTimeout(() => playBeep(f, 0.2, 'sine', 0.5), i * 100);
  });
}

/* ============================================================
   TOAST NOTIFICATIONS
   ============================================================ */
function showToast(icon, text, dur = 3000) {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.innerHTML = `<span class="toast-icon">${icon}</span><span class="toast-text">${text}</span>`;
  container.appendChild(toast);
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateX(30px)';
    toast.style.transition = 'all 0.3s ease';
    setTimeout(() => toast.remove(), 300);
  }, dur);
}

/* ============================================================
   TIMER
   ============================================================ */
function startTimer() {
  STATE.timerInterval = setInterval(() => {
    if (!STATE.isPaused) {
      STATE.timerSeconds++;
      updateTimerDisplay();
      // Update calories (approx 0.32 kcal per push-up, but also time-based)
      const caloriesPerSec = 0.06; // ~3.5 cal/min at rest during exercise
      const repCalories = STATE.repCount * 0.32;
      const totalCal = Math.round(repCalories + STATE.timerSeconds * caloriesPerSec * 0.3);
      document.getElementById('caloriesVal').textContent = totalCal;
    }
  }, 1000);
}

function stopTimer() {
  clearInterval(STATE.timerInterval);
}

function updateTimerDisplay() {
  const m = Math.floor(STATE.timerSeconds / 60).toString().padStart(2, '0');
  const s = (STATE.timerSeconds % 60).toString().padStart(2, '0');
  document.getElementById('timerDisplay').textContent = `${m}:${s}`;
}

/* ============================================================
   UI UPDATES
   ============================================================ */
function updateRepCounter() {
  const el = document.getElementById('repCount');
  el.textContent = STATE.repCount;
  el.classList.remove('animate');
  void el.offsetWidth;
  el.classList.add('animate');

  // Flash effect
  const flash = document.getElementById('repFlash');
  flash.classList.remove('flash');
  void flash.offsetWidth;
  flash.classList.add('flash');
}

function updateStats() {
  document.getElementById('perfectCount').textContent = STATE.perfectCount;
  document.getElementById('wrongCount').textContent = STATE.wrongCount;
  const acc = STATE.repCount > 0 ? Math.round((STATE.perfectCount / STATE.repCount) * 100) : 100;
  document.getElementById('accuracyVal').textContent = acc + '%';
  document.getElementById('streakVal').textContent = STATE.currentStreak;

  // Goal ring
  const goal = STATE.dailyGoal;
  const pct = Math.min(100, Math.round((STATE.repCount / goal) * 100));
  document.getElementById('goalPct').textContent = pct + '%';
  document.getElementById('goalDesc').textContent = `${STATE.repCount} / ${goal} reps`;
  const circumference = 2 * Math.PI * 30; // r=30
  const offset = circumference - (pct / 100) * circumference;
  document.getElementById('goalRingFill').style.strokeDashoffset = offset;

  // Goal reached milestone
  if (STATE.repCount === STATE.dailyGoal) {
    showToast('üéØ', 'Daily goal reached! Keep going!');
    playMilestoneSound();
  }
}

function setFeedback(text, type) {
  const el = document.getElementById('feedbackText');
  el.textContent = text;
  el.className = 'feedback-text ' + type;
}

function updateConfidence(val) {
  const pct = Math.round(val * 100);
  document.getElementById('confidenceFill').style.width = pct + '%';
  document.getElementById('confidenceVal').textContent = pct + '%';
}

function updatePhase(phase) {
  document.getElementById('phaseUp').classList.toggle('active', phase === 'up');
  document.getElementById('phaseDown').classList.toggle('active', phase === 'down');
}

/* ============================================================
   ANGLE CALCULATION HELPERS
   ============================================================ */
function calcAngle(a, b, c) {
  // Angle at point B between A-B-C
  const radians = Math.atan2(c.y - b.y, c.x - b.x) - Math.atan2(a.y - b.y, a.x - b.x);
  let angle = Math.abs(radians * 180 / Math.PI);
  if (angle > 180) angle = 360 - angle;
  return angle;
}

function getLandmark(landmarks, index) {
  const lm = landmarks[index];
  if (!lm) return null;
  return { x: lm.x, y: lm.y, z: lm.z || 0, visibility: lm.visibility || 0 };
}

/* ============================================================
   PUSH-UP DETECTION LOGIC
   ============================================================ */
function analyzePushup(landmarks) {
  // Key landmarks indices (MediaPipe Pose):
  // 11: left shoulder, 12: right shoulder
  // 13: left elbow,   14: right elbow
  // 15: left wrist,   16: right wrist
  // 23: left hip,     24: right hip
  // 25: left knee,    26: right knee
  // 27: left ankle,   28: right ankle

  const leftShoulder  = getLandmark(landmarks, 11);
  const rightShoulder = getLandmark(landmarks, 12);
  const leftElbow     = getLandmark(landmarks, 13);
  const rightElbow    = getLandmark(landmarks, 14);
  const leftWrist     = getLandmark(landmarks, 15);
  const rightWrist    = getLandmark(landmarks, 16);
  const leftHip       = getLandmark(landmarks, 23);
  const rightHip      = getLandmark(landmarks, 24);
  const leftKnee      = getLandmark(landmarks, 25);
  const rightKnee     = getLandmark(landmarks, 26);

  // Check visibility
  const minVis = 0.5;
  const keypoints = [leftShoulder, rightShoulder, leftElbow, rightElbow, leftWrist, rightWrist, leftHip, rightHip];
  const confidence = keypoints.filter(k => k && k.visibility > minVis).length / keypoints.length;
  updateConfidence(confidence);

  if (confidence < 0.5) {
    setFeedback('üì∑ Position yourself in frame', 'warn');
    return;
  }

  // Average elbow angle (use visible side)
  let elbowAngle = null;
  const leftElbowAngle = (leftShoulder && leftElbow && leftWrist && leftShoulder.visibility > minVis) ?
    calcAngle(leftShoulder, leftElbow, leftWrist) : null;
  const rightElbowAngle = (rightShoulder && rightElbow && rightWrist && rightShoulder.visibility > minVis) ?
    calcAngle(rightShoulder, rightElbow, rightWrist) : null;

  if (leftElbowAngle !== null && rightElbowAngle !== null) {
    elbowAngle = (leftElbowAngle + rightElbowAngle) / 2;
  } else if (leftElbowAngle !== null) {
    elbowAngle = leftElbowAngle;
  } else if (rightElbowAngle !== null) {
    elbowAngle = rightElbowAngle;
  }

  if (elbowAngle === null) return;

  // Back alignment: shoulder-hip-knee line should be straight
  let backAngle = null;
  if (leftShoulder && leftHip && leftKnee && leftShoulder.visibility > 0.4 && leftHip.visibility > 0.4) {
    backAngle = calcAngle(leftShoulder, leftHip, leftKnee || {x: leftHip.x, y: leftHip.y + 0.2});
  } else if (rightShoulder && rightHip && rightKnee) {
    backAngle = calcAngle(rightShoulder, rightHip, rightKnee || {x: rightHip.x, y: rightHip.y + 0.2});
  }

  // Speed check
  const now = Date.now();
  const timeSinceLastRep = now - STATE.lastRepTime;

  // Phase detection thresholds
  const DOWN_THRESHOLD = 90;  // elbow angle <= 90¬∞ = down position
  const UP_THRESHOLD = 160;   // elbow angle >= 160¬∞ = up position

  // Back alignment: if angle deviates too much from 180¬∞
  const backStraight = backAngle === null || (backAngle > 150 && backAngle < 210);
  STATE.backIssue = !backStraight;

  // Update phase
  if (elbowAngle <= DOWN_THRESHOLD) {
    if (STATE.pushupPhase === 'up') {
      STATE.pushupPhase = 'going_down';
    }
    if (STATE.pushupPhase === 'going_down') {
      STATE.downReached = true;
      STATE.pushupPhase = 'down';
    }
    updatePhase('down');
  }

  if (elbowAngle >= UP_THRESHOLD && STATE.downReached) {
    if (STATE.pushupPhase === 'down' || STATE.pushupPhase === 'going_down') {
      // Count the rep
      const tooFast = timeSinceLastRep < 500; // less than 0.5s is too fast
      const isPerfect = !STATE.backIssue && !tooFast && STATE.downReached;

      STATE.repCount++;
      STATE.lastRepTime = now;
      STATE.fastMovement = tooFast;
      STATE.downReached = false;
      STATE.pushupPhase = 'up';

      if (isPerfect) {
        STATE.perfectCount++;
        STATE.currentStreak++;
        STATE.maxStreak = Math.max(STATE.maxStreak, STATE.currentStreak);
        setFeedback('‚úÖ Perfect Rep!', 'good');
        playRepSound(true);
        if (STATE.currentStreak % 10 === 0) {
          showToast('üî•', `${STATE.currentStreak} rep streak!`);
          playMilestoneSound();
        }
      } else {
        STATE.wrongCount++;
        STATE.currentStreak = 0;
        const reason = tooFast ? '‚ö° Too Fast!' : STATE.backIssue ? 'üìè Straighten Your Back' : '‚¨áÔ∏è Go Lower';
        setFeedback('‚ùå ' + reason.replace('‚ùå ', ''), 'bad');
        playRepSound(false);
      }

      updateRepCounter();
      updateStats();

      // Milestones
      if (STATE.repCount % 25 === 0) {
        showToast('üí™', `${STATE.repCount} push-ups done!`);
      }
    }
    updatePhase('up');
  }

  // Continuous feedback when not counting
  if (STATE.pushupPhase === 'up' && elbowAngle >= UP_THRESHOLD) {
    if (STATE.backIssue) {
      setFeedback('üìè Straighten Your Back', 'warn');
    } else {
      setFeedback('üü¢ Good Form ‚Äî Go Down', 'good');
    }
  } else if (STATE.pushupPhase === 'going_down' || STATE.pushupPhase === 'down') {
    if (elbowAngle > DOWN_THRESHOLD) {
      setFeedback('‚¨áÔ∏è Go Lower', 'warn');
    } else {
      setFeedback('‚¨ÜÔ∏è Push Up!', 'good');
    }
  }

  STATE.lastAngle = elbowAngle;
}

/* ============================================================
   MEDIAPIPE POSE
   ============================================================ */
let poseInstance = null;
let cameraInstance = null;
let videoEl = document.getElementById('video-feed');
let canvasEl = document.getElementById('pose-canvas');
let canvasCtx = canvasEl.getContext('2d');

function onPoseResults(results) {
  if (STATE.isPaused || !STATE.isWorkoutActive) return;

  // Resize canvas to match video
  canvasEl.width = videoEl.videoWidth || 640;
  canvasEl.height = videoEl.videoHeight || 480;

  canvasCtx.save();
  canvasCtx.clearRect(0, 0, canvasEl.width, canvasEl.height);

  // Draw pose skeleton
  if (results.poseLandmarks) {
    // Draw connections
    drawConnectors(canvasCtx, results.poseLandmarks, POSE_CONNECTIONS, {
      color: 'rgba(0, 212, 255, 0.7)',
      lineWidth: 2
    });

    // Draw landmarks
    drawLandmarks(canvasCtx, results.poseLandmarks, {
      color: 'rgba(0, 212, 255, 1)',
      fillColor: 'rgba(0, 212, 255, 0.3)',
      lineWidth: 1,
      radius: (data) => {
        // Make important joints bigger
        const important = [11, 12, 13, 14, 15, 16, 23, 24];
        return important.includes(data.index) ? 6 : 3;
      }
    });

    // Run push-up analysis
    analyzePushup(results.poseLandmarks);
  }

  canvasCtx.restore();
}

async function initMediaPipe() {
  const overlay = document.getElementById('cameraOverlay');
  overlay.querySelector('.camera-overlay-text').textContent = 'REQUESTING CAMERA ACCESS...';

  try {
    const pose = new Pose({
      locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
    });

    pose.setOptions({
      modelComplexity: 1,
      smoothLandmarks: true,
      enableSegmentation: false,
      smoothSegmentation: false,
      minDetectionConfidence: 0.6,
      minTrackingConfidence: 0.6
    });

    pose.onResults(onPoseResults);
    poseInstance = pose;

    const camera = new Camera(videoEl, {
      onFrame: async () => {
        if (poseInstance && STATE.isWorkoutActive && !STATE.isPaused) {
          await poseInstance.send({ image: videoEl });
        }
      },
      width: 1280,
      height: 720
    });

    await camera.start();
    cameraInstance = camera;

    // Hide overlay
    overlay.classList.add('hidden');
    document.getElementById('liveBadge').classList.add('active');
    document.getElementById('formFeedback').classList.add('active');
    document.getElementById('phaseIndicator').classList.add('active');

    showToast('üì∑', 'Camera active. Get into push-up position!');

  } catch (err) {
    console.error('MediaPipe/Camera error:', err);
    overlay.querySelector('.camera-overlay-text').textContent = 'CAMERA ACCESS DENIED';
    overlay.querySelector('.camera-icon').innerHTML = '<i class="fas fa-camera-slash" style="color:var(--accent-red)"></i>';
    showToast('‚ùå', 'Camera access denied. Please allow camera permission.');
    // Demo mode without camera
    startDemoMode();
  }
}

/* ============================================================
   DEMO MODE (when camera unavailable)
   ============================================================ */
function startDemoMode() {
  const overlay = document.getElementById('cameraOverlay');
  overlay.classList.add('hidden');
  document.getElementById('liveBadge').classList.add('active');
  document.getElementById('formFeedback').classList.add('active');
  document.getElementById('phaseIndicator').classList.add('active');

  // Draw demo animation on canvas
  canvasEl.width = 640;
  canvasEl.height = 360;

  let demoAngle = 170;
  let demoDir = -1;
  let demoPhaseLocal = 'up';

  const demoLoop = setInterval(() => {
    if (!STATE.isWorkoutActive) { clearInterval(demoLoop); return; }
    if (STATE.isPaused) return;

    canvasCtx.clearRect(0, 0, 640, 360);

    // Draw demo figure
    canvasCtx.save();
    const cx = 320, cy = 200;

    // Simulate push-up motion
    demoAngle += demoDir * 2;
    if (demoAngle <= 70) { demoDir = 1; demoPhaseLocal = 'up'; }
    if (demoAngle >= 170) { demoDir = -1; demoPhaseLocal = 'down'; }

    const rad = (demoAngle * Math.PI) / 180;

    // Body line
    canvasCtx.strokeStyle = 'rgba(0,212,255,0.6)';
    canvasCtx.lineWidth = 3;
    canvasCtx.beginPath();
    canvasCtx.moveTo(cx - 100, cy);
    canvasCtx.lineTo(cx + 100, cy);
    canvasCtx.stroke();

    // Arms
    const elbowX = cx - 60 + Math.cos(rad) * 60;
    const elbowY = cy + Math.sin(rad) * 50;

    canvasCtx.beginPath();
    canvasCtx.moveTo(cx - 60, cy);
    canvasCtx.lineTo(elbowX, elbowY);
    canvasCtx.moveTo(elbowX, elbowY);
    canvasCtx.lineTo(cx - 60, cy + 80);
    canvasCtx.stroke();

    // Same for right arm
    const rElbowX = cx + 60 - Math.cos(rad) * 60;
    const rElbowY = cy + Math.sin(rad) * 50;

    canvasCtx.beginPath();
    canvasCtx.moveTo(cx + 60, cy);
    canvasCtx.lineTo(rElbowX, rElbowY);
    canvasCtx.moveTo(rElbowX, rElbowY);
    canvasCtx.lineTo(cx + 60, cy + 80);
    canvasCtx.stroke();

    // Head
    canvasCtx.beginPath();
    canvasCtx.arc(cx - 120, cy, 20, 0, Math.PI * 2);
    canvasCtx.strokeStyle = 'rgba(0,212,255,0.8)';
    canvasCtx.stroke();

    // Angle display
    canvasCtx.fillStyle = 'rgba(0,212,255,0.9)';
    canvasCtx.font = 'bold 16px Orbitron';
    canvasCtx.fillText(`${Math.round(demoAngle)}¬∞`, elbowX + 10, elbowY);

    canvasCtx.fillStyle = 'rgba(255,255,255,0.4)';
    canvasCtx.font = '14px Rajdhani';
    canvasCtx.fillText('DEMO MODE ‚Äî Allow camera for full tracking', 20, 30);

    canvasCtx.restore();

    // Simulate rep counting
    const fakeResults = {
      poseLandmarks: generateFakeLandmarks(demoAngle, cx, cy)
    };
    analyzePushup(fakeResults.poseLandmarks);
    updateConfidence(0.85);

  }, 50);

  showToast('üéÆ', 'Demo mode active. Camera access denied.');
}

function generateFakeLandmarks(elbowAngle, cx, cy) {
  // Generate fake normalized landmarks for demo
  const rad = (elbowAngle * Math.PI) / 180;
  const W = 640, H = 360;

  const landmarks = new Array(33).fill(null).map((_, i) => ({
    x: 0.5, y: 0.5, z: 0, visibility: 0.2
  }));

  const shoulderY = cy / H;
  const hipY = (cy + 0.1 * H) / H;
  const wristY = (cy + 0.15 * H) / H;
  const elbowY_norm = (cy + Math.sin(rad) * 50) / H;
  const elbowX_l = (cx / 2 - 60 + Math.cos(rad) * 60) / W + 0.2;
  const elbowX_r = (cx / 2 + 60 - Math.cos(rad) * 60) / W + 0.3;

  // Left shoulder (11), right shoulder (12)
  landmarks[11] = { x: 0.35, y: shoulderY, z: 0, visibility: 0.95 };
  landmarks[12] = { x: 0.65, y: shoulderY, z: 0, visibility: 0.95 };
  // Left elbow (13), right elbow (14)
  landmarks[13] = { x: 0.3, y: elbowY_norm, z: 0, visibility: 0.95 };
  landmarks[14] = { x: 0.7, y: elbowY_norm, z: 0, visibility: 0.95 };
  // Left wrist (15), right wrist (16)
  landmarks[15] = { x: 0.3, y: wristY, z: 0, visibility: 0.95 };
  landmarks[16] = { x: 0.7, y: wristY, z: 0, visibility: 0.95 };
  // Left hip (23), right hip (24)
  landmarks[23] = { x: 0.4, y: hipY, z: 0, visibility: 0.8 };
  landmarks[24] = { x: 0.6, y: hipY, z: 0, visibility: 0.8 };
  // Left knee (25), right knee (26)
  landmarks[25] = { x: 0.4, y: hipY + 0.15, z: 0, visibility: 0.7 };
  landmarks[26] = { x: 0.6, y: hipY + 0.15, z: 0, visibility: 0.7 };

  return landmarks;
}

/* ============================================================
   WORKOUT FLOW
   ============================================================ */
function startWorkout() {
  // Scroll to workout
  document.getElementById('hero').style.display = 'none';
  document.getElementById('workout').classList.add('active');
  document.getElementById('workout').scrollIntoView({ behavior: 'smooth' });

  // Reset state
  STATE.isWorkoutActive = true;
  STATE.isPaused = false;
  STATE.repCount = 0;
  STATE.perfectCount = 0;
  STATE.wrongCount = 0;
  STATE.currentStreak = 0;
  STATE.maxStreak = 0;
  STATE.timerSeconds = 0;
  STATE.downReached = false;
  STATE.pushupPhase = 'up';
  STATE.dailyGoal = parseInt(document.getElementById('dailyGoalInput').value) || 50;
  document.getElementById('goalTarget').textContent = STATE.dailyGoal;

  // Reset UI
  updateRepCounter();
  updateStats();
  updateTimerDisplay();
  document.getElementById('caloriesVal').textContent = '0';

  // Start timer
  startTimer();

  // Init camera / mediapipe
  initMediaPipe();

  // Music
  if (STATE.musicEnabled) {
    document.getElementById('musicBar').style.display = 'flex';
  }
}

function pauseWorkout() {
  STATE.isPaused = !STATE.isPaused;
  const btn = document.getElementById('pauseBtn');
  if (STATE.isPaused) {
    btn.innerHTML = '<i class="fas fa-play"></i> RESUME';
    setFeedback('‚è∏ Workout Paused', 'warn');
  } else {
    btn.innerHTML = '<i class="fas fa-pause"></i> PAUSE';
    setFeedback('üü¢ Resume Position', 'good');
  }
}

function endWorkout() {
  STATE.isWorkoutActive = false;
  stopTimer();

  // Stop camera
  if (cameraInstance) {
    try { cameraInstance.stop(); } catch(e) {}
    cameraInstance = null;
  }

  // Save to history
  const sessionData = {
    date: new Date().toLocaleDateString(),
    reps: STATE.repCount,
    perfect: STATE.perfectCount,
    wrong: STATE.wrongCount,
    accuracy: STATE.repCount > 0 ? Math.round((STATE.perfectCount / STATE.repCount) * 100) : 0,
    duration: STATE.timerSeconds,
    calories: parseInt(document.getElementById('caloriesVal').textContent),
    streak: STATE.maxStreak,
    timestamp: Date.now()
  };

  STATE.historyLog.unshift(sessionData);
  if (STATE.historyLog.length > 50) STATE.historyLog.pop();
  localStorage.setItem('pmPro_history', JSON.stringify(STATE.historyLog));

  // Update lifetime
  STATE.lifetimeData.pushups += STATE.repCount;
  STATE.lifetimeData.sessions++;
  STATE.lifetimeData.best = Math.max(STATE.lifetimeData.best, STATE.repCount);

  // Check day streak
  const today = new Date().toDateString();
  if (STATE.lifetimeData.lastDate !== today && STATE.repCount > 0) {
    const yesterday = new Date(Date.now() - 86400000).toDateString();
    if (STATE.lifetimeData.lastDate === yesterday) {
      STATE.lifetimeData.streak++;
    } else {
      STATE.lifetimeData.streak = 1;
    }
    STATE.lifetimeData.lastDate = today;
  }

  localStorage.setItem('pmPro_lifetime', JSON.stringify(STATE.lifetimeData));

  // Weekly data
  const todayKey = new Date().toISOString().split('T')[0];
  const existing = STATE.weeklyData.find(d => d.date === todayKey);
  if (existing) {
    existing.reps += STATE.repCount;
  } else {
    STATE.weeklyData.push({ date: todayKey, reps: STATE.repCount });
    if (STATE.weeklyData.length > 7) STATE.weeklyData.shift();
  }
  localStorage.setItem('pmPro_weekly', JSON.stringify(STATE.weeklyData));

  // Show modal
  showSummaryModal(sessionData);

  // Reset to hero after modal
  document.getElementById('workout').classList.remove('active');
  document.getElementById('hero').style.display = '';

  // Update hero stats
  loadLifetimeStats();
  loadHistory();
  renderWeeklyChart();
}

function showSummaryModal(data) {
  document.getElementById('modalReps').textContent = data.reps;
  document.getElementById('modalPerfect').textContent = data.perfect;
  document.getElementById('modalAccuracy').textContent = data.accuracy + '%';
  document.getElementById('modalCalories').textContent = data.calories;
  const m = Math.floor(data.duration / 60).toString().padStart(2,'0');
  const s = (data.duration % 60).toString().padStart(2,'0');
  document.getElementById('modalDuration').textContent = `${m}:${s}`;
  document.getElementById('modalStreak').textContent = data.streak;

  // Motivational message
  const msgs = ['Incredible session!', 'Keep crushing it!', 'You\'re unstoppable!', 'Beast mode activated!'];
  document.getElementById('modalSubtitle').textContent = data.reps > 0 ? msgs[Math.floor(Math.random() * msgs.length)] : 'See you next time!';

  document.getElementById('summaryModal').classList.add('active');
  playMilestoneSound();
}

/* ============================================================
   HISTORY TABLE & CHART
   ============================================================ */
function loadHistory() {
  const tbody = document.getElementById('historyBody');
  if (STATE.historyLog.length === 0) {
    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:var(--text-muted);padding:40px">No workouts yet. Start your first session!</td></tr>';
    return;
  }
  tbody.innerHTML = STATE.historyLog.map(d => {
    const m = Math.floor(d.duration / 60).toString().padStart(2,'0');
    const s = (d.duration % 60).toString().padStart(2,'0');
    const accBadge = d.accuracy >= 80 ? 'badge-green' : d.accuracy >= 60 ? 'badge-gold' : 'badge-blue';
    return `
      <tr>
        <td>${d.date}</td>
        <td style="color:var(--accent-blue);font-family:var(--font-display);font-weight:700">${d.reps}</td>
        <td style="color:var(--accent-green)">${d.perfect}</td>
        <td><span class="badge ${accBadge}">${d.accuracy}%</span></td>
        <td>${m}:${s}</td>
        <td style="color:var(--accent-gold)">${d.calories} kcal</td>
      </tr>
    `;
  }).join('');
}

function loadLifetimeStats() {
  document.getElementById('totalLifetimePushups').textContent = STATE.lifetimeData.pushups.toLocaleString();
  document.getElementById('totalSessions').textContent = STATE.lifetimeData.sessions;
  document.getElementById('bestSetStat').textContent = STATE.lifetimeData.best;
  document.getElementById('currentStreakStat').textContent = STATE.lifetimeData.streak;
}

let weeklyChart = null;
function renderWeeklyChart() {
  const ctx = document.getElementById('weeklyChart').getContext('2d');

  // Generate last 7 days labels
  const labels = [];
  const data = [];
  for (let i = 6; i >= 0; i--) {
    const d = new Date(Date.now() - i * 86400000);
    const key = d.toISOString().split('T')[0];
    const dayName = d.toLocaleDateString('en', { weekday: 'short' });
    labels.push(dayName);
    const entry = STATE.weeklyData.find(e => e.date === key);
    data.push(entry ? entry.reps : 0);
  }

  if (weeklyChart) weeklyChart.destroy();

  weeklyChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        label: 'Push-Ups',
        data,
        backgroundColor: 'rgba(0, 212, 255, 0.2)',
        borderColor: 'rgba(0, 212, 255, 0.8)',
        borderWidth: 2,
        borderRadius: 8,
        borderSkipped: false,
        hoverBackgroundColor: 'rgba(0, 212, 255, 0.4)',
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: 'rgba(13, 13, 26, 0.95)',
          borderColor: 'rgba(0, 212, 255, 0.3)',
          borderWidth: 1,
          titleColor: '#00d4ff',
          bodyColor: '#f0f0ff',
          cornerRadius: 8,
          callbacks: {
            label: ctx => ` ${ctx.parsed.y} push-ups`
          }
        }
      },
      scales: {
        x: {
          grid: { color: 'rgba(255,255,255,0.03)', drawBorder: false },
          ticks: { color: 'rgba(240,240,255,0.5)', font: { family: 'Space Mono', size: 11 } }
        },
        y: {
          grid: { color: 'rgba(255,255,255,0.05)', drawBorder: false },
          ticks: { color: 'rgba(240,240,255,0.5)', font: { family: 'Space Mono', size: 11 }, stepSize: 10 },
          beginAtZero: true
        }
      }
    }
  });
}

/* ============================================================
   EXPORT
   ============================================================ */
function exportWorkoutSummary() {
  const lines = [
    'PUSHMASTER PRO ‚Äî WORKOUT SUMMARY',
    '=================================',
    `Generated: ${new Date().toLocaleString()}`,
    '',
    'LIFETIME STATS',
    `--------------`,
    `Total Push-Ups: ${STATE.lifetimeData.pushups}`,
    `Sessions: ${STATE.lifetimeData.sessions}`,
    `Best Set: ${STATE.lifetimeData.best}`,
    `Day Streak: ${STATE.lifetimeData.streak}`,
    '',
    'LAST SESSION',
    '------------',
    `Reps: ${STATE.repCount}`,
    `Perfect: ${STATE.perfectCount}`,
    `Wrong: ${STATE.wrongCount}`,
    `Accuracy: ${STATE.repCount > 0 ? Math.round((STATE.perfectCount/STATE.repCount)*100) : 0}%`,
    `Duration: ${Math.floor(STATE.timerSeconds/60)}m ${STATE.timerSeconds%60}s`,
    '',
    'WORKOUT HISTORY',
    '---------------',
    ...STATE.historyLog.map(d => `${d.date} | ${d.reps} reps | ${d.accuracy}% accuracy | ${Math.floor(d.duration/60)}m ${d.duration%60}s`),
    '',
    'AI systems can make mistakes. Always double-check workout tracking accuracy.',
    '',
    'PushMaster Pro ‚Äî Train Smart. Train Perfect. | ¬© 2026'
  ];

  const blob = new Blob([lines.join('\n')], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `pushmaster-pro-${Date.now()}.txt`;
  a.click();
  URL.revokeObjectURL(url);
  showToast('üì•', 'Workout exported successfully!');
}

/* ============================================================
   EVENT LISTENERS
   ============================================================ */
document.getElementById('startWorkoutBtn').addEventListener('click', () => {
  playBeep(440, 0.1);
  startWorkout();
});

document.getElementById('viewHistoryBtn').addEventListener('click', () => {
  document.getElementById('dashboard').scrollIntoView({ behavior: 'smooth' });
});

document.getElementById('pauseBtn').addEventListener('click', pauseWorkout);

document.getElementById('stopBtn').addEventListener('click', () => {
  if (confirm('End this workout session?')) {
    endWorkout();
  }
});

document.getElementById('settingsBtn').addEventListener('click', () => {
  document.getElementById('settingsPanel').classList.add('open');
});

document.getElementById('closeSettingsBtn').addEventListener('click', () => {
  document.getElementById('settingsPanel').classList.remove('open');
});

document.getElementById('closeModalBtn').addEventListener('click', () => {
  document.getElementById('summaryModal').classList.remove('active');
});

document.getElementById('newWorkoutBtn').addEventListener('click', () => {
  document.getElementById('summaryModal').classList.remove('active');
  startWorkout();
});

document.getElementById('exportSummaryBtn').addEventListener('click', exportWorkoutSummary);
document.getElementById('exportBtn').addEventListener('click', exportWorkoutSummary);

// Theme toggle
document.getElementById('themeToggleBtn').addEventListener('click', () => {
  document.body.classList.toggle('neon-theme');
  const icon = document.querySelector('#themeToggleBtn i');
  icon.classList.toggle('fa-bolt');
  icon.classList.toggle('fa-leaf');
  showToast('üé®', 'Theme switched!');
});

document.getElementById('neonThemeToggle').addEventListener('change', (e) => {
  document.body.classList.toggle('neon-theme', e.target.checked);
});

// Sound toggle
document.getElementById('soundToggleBtn').addEventListener('click', () => {
  STATE.soundEnabled = !STATE.soundEnabled;
  const btn = document.getElementById('soundToggleBtn');
  btn.classList.toggle('active', !STATE.soundEnabled);
  const icon = btn.querySelector('i');
  icon.className = STATE.soundEnabled ? 'fas fa-volume-high' : 'fas fa-volume-xmark';
  document.getElementById('soundEffectToggle').checked = STATE.soundEnabled;
});

document.getElementById('soundEffectToggle').addEventListener('change', (e) => {
  STATE.soundEnabled = e.target.checked;
  document.getElementById('soundToggleBtn').classList.toggle('active', !STATE.soundEnabled);
});

// Music toggle
document.getElementById('musicToggle').addEventListener('change', (e) => {
  STATE.musicEnabled = e.target.checked;
  document.getElementById('musicBar').style.display = STATE.musicEnabled && STATE.isWorkoutActive ? 'flex' : 'none';
});

// Music play/pause button
let musicPlaying = false;
document.getElementById('musicPlayBtn').addEventListener('click', () => {
  musicPlaying = !musicPlaying;
  const icon = document.getElementById('musicPlayIcon');
  icon.className = musicPlaying ? 'fas fa-pause' : 'fas fa-play';
  document.getElementById('musicEq').classList.toggle('paused', !musicPlaying);
  // In a real app, you'd control an audio element here
  showToast(musicPlaying ? 'üéµ' : '‚è∏', musicPlaying ? 'Music playing' : 'Music paused');
});

// Fullscreen
document.getElementById('fullscreenBtn').addEventListener('click', () => {
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen();
    document.querySelector('#fullscreenBtn i').className = 'fas fa-compress';
  } else {
    document.exitFullscreen();
    document.querySelector('#fullscreenBtn i').className = 'fas fa-expand';
  }
});

// Settings - daily goal
document.getElementById('dailyGoalInput').addEventListener('change', (e) => {
  STATE.dailyGoal = parseInt(e.target.value) || 50;
  document.getElementById('goalTarget').textContent = STATE.dailyGoal;
});

// Clear history
document.getElementById('clearHistoryBtn').addEventListener('click', () => {
  if (confirm('Clear all workout history?')) {
    STATE.historyLog = [];
    STATE.lifetimeData = { pushups: 0, sessions: 0, best: 0, streak: 0, lastDate: '' };
    STATE.weeklyData = [];
    localStorage.removeItem('pmPro_history');
    localStorage.removeItem('pmPro_lifetime');
    localStorage.removeItem('pmPro_weekly');
    loadHistory();
    loadLifetimeStats();
    renderWeeklyChart();
    showToast('üóëÔ∏è', 'History cleared.');
  }
});

// Close modal on overlay click
document.getElementById('summaryModal').addEventListener('click', (e) => {
  if (e.target === document.getElementById('summaryModal')) {
    document.getElementById('summaryModal').classList.remove('active');
  }
});

// Close settings on outside click
document.addEventListener('click', (e) => {
  const panel = document.getElementById('settingsPanel');
  const btn = document.getElementById('settingsBtn');
  if (panel.classList.contains('open') && !panel.contains(e.target) && !btn.contains(e.target)) {
    panel.classList.remove('open');
  }
});

/* ============================================================
   INIT
   ============================================================ */
function init() {
  loadLifetimeStats();
  loadHistory();
  renderWeeklyChart();

  // Show hero stats with counting animation
  function animateCount(el, target) {
    let current = 0;
    const step = Math.max(1, Math.floor(target / 30));
    const interval = setInterval(() => {
      current = Math.min(current + step, target);
      el.textContent = current.toLocaleString();
      if (current >= target) clearInterval(interval);
    }, 30);
  }

  setTimeout(() => {
    animateCount(document.getElementById('totalLifetimePushups'), STATE.lifetimeData.pushups);
    animateCount(document.getElementById('totalSessions'), STATE.lifetimeData.sessions);
    animateCount(document.getElementById('bestSetStat'), STATE.lifetimeData.best);
    animateCount(document.getElementById('currentStreakStat'), STATE.lifetimeData.streak);
  }, 1200);
}

// Wait for DOM
window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
